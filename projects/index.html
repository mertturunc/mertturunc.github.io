---
layout: default
title: yaptıklarım
lang: tr
language_reference: projects
redirect_from: "/about/"
summary: Portfolyo sayılabilecek bir sayfa
---
{% include language-utils.html %}

<script>
    // Cache the collapsible elements with accordion behavior and URL hash support
    document.addEventListener('DOMContentLoaded', function() {
      const coll = document.getElementsByClassName("collapsible");
      
      // Function to close all containers
      function closeAllContainers() {
        for (let j = 0; j < coll.length; j++) {
          coll[j].classList.remove("active");
          const content = coll[j].nextElementSibling;
          content.classList.remove("content-open");
        }
      }
      
      // Function to open specific container by index
      function openContainer(index) {
        if (index >= 0 && index < coll.length) {
          coll[index].classList.add("active");
          const content = coll[index].nextElementSibling;
          content.classList.add("content-open");
        }
      }
      
      // Function to generate hash from project title
      function generateHash(title) {
        return title.toLowerCase()
          .replace(/[^a-z0-9\s-]/g, '')
          .replace(/\s+/g, '-')
          .replace(/-+/g, '-')
          .trim();
      }
      
      // Set up click handlers
      for (let i = 0; i < coll.length; i++) {
        const projectTitle = coll[i].textContent;
        const projectHash = generateHash(projectTitle);
        coll[i].setAttribute('data-hash', projectHash);
        
        coll[i].addEventListener("click", function() {
          const content = this.nextElementSibling;
          const isCurrentlyOpen = content.classList.contains("content-open");
          
          // Close all other collapsible content with animation
          closeAllContainers();
          
          // Toggle current content with animation and update URL
          if (isCurrentlyOpen) {
            // If closing, remove hash from URL
            history.pushState(null, null, window.location.pathname);
          } else {
            // If opening, add hash to URL
            this.classList.add("active");
            content.classList.add("content-open");
            history.pushState(null, null, '#' + projectHash);
          }
        });
      }
      
      // Handle direct hash navigation and browser back/forward
      function handleHashChange() {
        const hash = window.location.hash.substring(1);
        closeAllContainers();
        
        if (hash) {
          for (let i = 0; i < coll.length; i++) {
            if (coll[i].getAttribute('data-hash') === hash) {
              openContainer(i);
              // Smooth scroll to the opened container
              setTimeout(() => {
                coll[i].scrollIntoView({ behavior: 'smooth', block: 'start' });
              }, 100);
              break;
            }
          }
        }
      }
      
      // Listen for hash changes (browser back/forward)
      window.addEventListener('hashchange', handleHashChange);
      
      // Handle initial hash on page load
      handleHashChange();

      // Close collapsible content on ESC key press
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          // Only close if no modal is open
          if (!document.querySelector('.modal-overlay')) {
            closeAllContainers();
            // Remove hash from URL when closing with ESC
            history.pushState(null, null, window.location.pathname);
            // Hide maximize buttons after closing
            showMaximizeButtons();
          }
        }
      });

      // Maximize/minimize modal logic from scratch
      function showMaximizeButtons() {
        document.querySelectorAll('.collapsible').forEach(function(coll) {
          const maxBtn = coll.querySelector('.maximize-btn');
          if (maxBtn) {
            if (coll.classList.contains('active')) {
              maxBtn.style.display = 'inline-block';
              maxBtn.style.pointerEvents = 'auto';
            } else {
              maxBtn.style.display = 'none';
              maxBtn.style.pointerEvents = 'none';
            }
          }
        });
      }
      // Update maximize button visibility on open/close
      document.querySelectorAll('.collapsible').forEach(function(coll) {
        coll.addEventListener('click', function() {
          setTimeout(showMaximizeButtons, 10);
        });
      });
      window.addEventListener('hashchange', function() {
        setTimeout(showMaximizeButtons, 10);
      });
      showMaximizeButtons();

      // Modal maximize logic (refined close button + ESC support)
      let escListener = null;
      function createModal(contentNode) {
        // Clone the content node for modal
        const modalContent = contentNode.cloneNode(true);
        modalContent.classList.add('modal-maximized');
        // Create wrapper for modal content + close button
        const modalWrapper = document.createElement('div');
        modalWrapper.style.position = 'relative';
        modalWrapper.appendChild(modalContent);
        // Add close button positioned over the top right corner of modal content
        const closeBtn = document.createElement('button');
        closeBtn.className = 'modal-close-btn';
        closeBtn.innerHTML = '&times;';
        closeBtn.onclick = function(e) {
          e.stopPropagation();
          closeModal();
        };
        modalWrapper.appendChild(closeBtn);
        // Overlay
        const overlay = document.createElement('div');
        overlay.className = 'modal-overlay';
        overlay.appendChild(modalWrapper);
        overlay.onclick = function(e) {
          if (e.target === overlay) closeModal();
        };
        document.body.appendChild(overlay);
        document.body.classList.add('modal-open');
        
        // REINITIALIZE CAROUSELS IN MODAL
        setTimeout(() => {
          
          // Fix IDs to avoid conflicts and reinitialize carousels
          const carousels = modalContent.querySelectorAll('.image-carousel');
          
          carousels.forEach(function(carousel, index) {
            // Generate unique ID for modal carousel
            const originalId = carousel.id;
            const modalId = originalId + '-modal-' + Date.now() + '-' + index;
            carousel.id = modalId;
            
            
            // Clear the initialization flag completely
            delete carousel.carouselInitialized;
            carousel.removeAttribute('data-carousel-initialized');
            
            // Verify carousel elements exist
            const track = carousel.querySelector('.carousel-track');
            const slides = carousel.querySelectorAll('.carousel-slide');
            const prevBtn = carousel.querySelector('.carousel-prev');
            const nextBtn = carousel.querySelector('.carousel-next');
            
            
            // Call the full initialization function
            if (window.initializeCarousel) {
              try {
                window.initializeCarousel(carousel);
              } catch (error) {
              }
            } else {
            }
          });
          
          // Also handle compact carousels
          const compactCarousels = modalContent.querySelectorAll('.image-carousel-compact');
          
          compactCarousels.forEach(function(carousel, index) {
            // Generate unique ID
            const originalId = carousel.id;
            const modalId = originalId + '-modal-' + Date.now() + '-' + index;
            carousel.id = modalId;
            
            
            // Manually reinitialize compact carousel since it doesn't use the global function
            const track = carousel.querySelector('.carousel-track-compact');
            const slides = carousel.querySelectorAll('.carousel-slide-compact');
            const prevBtn = carousel.querySelector('.carousel-prev-compact');
            const nextBtn = carousel.querySelector('.carousel-next-compact');
            const dots = carousel.querySelectorAll('.carousel-dot-compact');
            const zoomInBtn = carousel.querySelector('.zoom-in-btn-compact');
            const zoomOutBtn = carousel.querySelector('.zoom-out-btn-compact');
            const zoomResetBtn = carousel.querySelector('.zoom-reset-btn-compact');
            const fullscreenBtn = carousel.querySelector('.fullscreen-btn-compact');
            const zoomIndicator = carousel.querySelector('.zoom-indicator-compact');
            
            if (slides.length > 0) {
              let currentIndex = 0;
              let currentZoom = 1;
              let translateX = 0;
              let translateY = 0;
              
              function updateCarousel() {
                const slideTranslateX = -currentIndex * 100;
                if (track) track.style.transform = `translateX(${slideTranslateX}%)`;
                
                dots.forEach((dot, idx) => {
                  dot.classList.toggle('active', idx === currentIndex);
                });
                
                if (prevBtn) prevBtn.style.opacity = currentIndex === 0 ? '0.5' : '1';
                if (nextBtn) nextBtn.style.opacity = currentIndex === slides.length - 1 ? '0.5' : '1';
              }
              
              function updateZoom() {
                if (zoomIndicator) zoomIndicator.textContent = Math.round(currentZoom * 100) + '%';
                const currentImage = slides[currentIndex]?.querySelector('.carousel-image-compact');
                if (currentImage) {
                  currentImage.style.transform = `scale(${currentZoom}) translate(${translateX}px, ${translateY}px)`;
                  currentImage.classList.toggle('zoomed', currentZoom > 1);
                }
                if (zoomResetBtn) zoomResetBtn.style.display = currentZoom > 1 ? 'flex' : 'none';
              }
              
              // Navigation
              if (nextBtn) nextBtn.onclick = () => {
                currentIndex = (currentIndex + 1) % slides.length;
                currentZoom = 1; translateX = 0; translateY = 0;
                updateCarousel(); updateZoom();
              };
              if (prevBtn) prevBtn.onclick = () => {
                currentIndex = (currentIndex - 1 + slides.length) % slides.length;
                currentZoom = 1; translateX = 0; translateY = 0;
                updateCarousel(); updateZoom();
              };
              
              // Zoom
              if (zoomInBtn) zoomInBtn.onclick = () => {
                if (currentZoom < 3) { currentZoom = Math.min(3, currentZoom + 0.25); updateZoom(); }
              };
              if (zoomOutBtn) zoomOutBtn.onclick = () => {
                if (currentZoom > 1) {
                  currentZoom = Math.max(1, currentZoom - 0.25);
                  if (currentZoom === 1) { translateX = 0; translateY = 0; }
                  updateZoom();
                }
              };
              if (zoomResetBtn) zoomResetBtn.onclick = () => {
                currentZoom = 1; translateX = 0; translateY = 0; updateZoom();
              };
              
              // Fullscreen - use the same logic as the original compact carousel
              if (fullscreenBtn) fullscreenBtn.onclick = () => {
                const currentImage = slides[currentIndex]?.querySelector('.carousel-image-compact');
                if (!currentImage) return;
                
                // Check for existing modal overlays and ensure lightbox appears above them
                const existingModals = document.querySelectorAll('.modal-overlay');
                let highestZIndex = 9998; // Default modal z-index
                
                existingModals.forEach(modal => {
                  const modalZIndex = parseInt(window.getComputedStyle(modal).zIndex) || 9998;
                  if (modalZIndex > highestZIndex) {
                    highestZIndex = modalZIndex;
                  }
                });
                
                // Temporarily hide existing modals to prevent z-index conflicts
                existingModals.forEach(modal => {
                  modal.style.visibility = 'hidden';
                });
                
                const lightbox = document.createElement('div');
                lightbox.className = 'carousel-lightbox';
                lightbox.style.cssText = `
                  position: fixed;
                  top: 0;
                  left: 0;
                  width: 100vw;
                  height: 100vh;
                  background: rgba(0, 0, 0, 0.95);
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  z-index: ${highestZIndex + 1000};
                  cursor: pointer;
                  backdrop-filter: blur(2px);
                  opacity: 0;
                  transition: opacity 0.3s ease;
                  pointer-events: auto;
                `;
                
                const mediaContainer = document.createElement('div');
                mediaContainer.style.cssText = `
                  position: relative;
                  max-width: 95vw;
                  max-height: 95vh;
                  cursor: default;
                `;
                
                const lightboxImage = document.createElement('img');
                lightboxImage.className = 'lightbox-image';
                lightboxImage.src = currentImage.src;
                lightboxImage.alt = currentImage.alt;
                lightboxImage.style.cssText = `
                  max-width: 100%;
                  max-height: 95vh;
                  border-radius: 6px;
                  object-fit: contain;
                  transition: opacity 0.3s ease;
                `;
                
                const closeBtn = document.createElement('button');
                closeBtn.innerHTML = '×';
                closeBtn.style.cssText = `
                  position: absolute;
                  top: 20px;
                  right: 20px;
                  background: rgba(0, 0, 0, 0.7);
                  color: white;
                  border: none;
                  width: 40px;
                  height: 40px;
                  border-radius: 50%;
                  font-size: 24px;
                  cursor: pointer;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  z-index: 1002;
                  transition: background 0.2s ease;
                `;
                
                closeBtn.addEventListener('mouseenter', () => {
                  closeBtn.style.background = 'rgba(0, 0, 0, 0.9)';
                });
                
                closeBtn.addEventListener('mouseleave', () => {
                  closeBtn.style.background = 'rgba(0, 0, 0, 0.7)';
                });
                
                mediaContainer.appendChild(lightboxImage);
                lightbox.appendChild(mediaContainer);
                lightbox.appendChild(closeBtn);
                
                // Event listeners for lightbox
                const closeLightbox = () => {
                  if (lightbox && document.body.contains(lightbox)) {
                    lightbox.style.opacity = '0';
                    setTimeout(() => {
                      if (lightbox && document.body.contains(lightbox)) {
                        document.body.removeChild(lightbox);
                        // Don't remove modal-open class if there are still other modals
                        const remainingModals = document.querySelectorAll('.modal-overlay');
                        if (remainingModals.length === 0) {
                          document.body.classList.remove('modal-open');
                        }
                      }
                      
                      // Restore visibility of any hidden modal overlays
                      const existingModals = document.querySelectorAll('.modal-overlay');
                      existingModals.forEach(modal => {
                        modal.style.visibility = 'visible';
                      });
                    }, 300);
                  }
                };
                
                closeBtn.addEventListener('click', closeLightbox);
                lightbox.addEventListener('click', closeLightbox);
                mediaContainer.addEventListener('click', (e) => e.stopPropagation());
                
                // ESC key support
                const escHandler = (e) => {
                  if (e.key === 'Escape') {
                    closeLightbox();
                    document.removeEventListener('keydown', escHandler);
                  }
                };
                document.addEventListener('keydown', escHandler);
                
                // Add lightbox to body and ensure it's above everything
                document.body.appendChild(lightbox);
                document.body.classList.add('modal-open');
                
                // Ensure the lightbox is the topmost element
                lightbox.style.zIndex = `${highestZIndex + 1000}`;
                
                // Fade in the lightbox
                setTimeout(() => {
                  if (lightbox) {
                    lightbox.style.opacity = '1';
                  }
                }, 10);
              };
              
              // Dots
              dots.forEach((dot, idx) => {
                dot.onclick = () => {
                  currentIndex = idx; currentZoom = 1; translateX = 0; translateY = 0;
                  updateCarousel(); updateZoom();
                };
              });
              
              // Initialize
              updateCarousel();
              updateZoom();
              
              
              // Test that buttons work
              if (nextBtn) {
              } else {
              }
            }
          });
          
          
          // Fallback verification - ensure at least basic click handlers work
          setTimeout(() => {
            const modalCarousels = overlay.querySelectorAll('.image-carousel, .image-carousel-compact');
            modalCarousels.forEach(carousel => {
              const nextBtns = carousel.querySelectorAll('.carousel-next, .carousel-next-compact');
              const prevBtns = carousel.querySelectorAll('.carousel-prev, .carousel-prev-compact');
              
              
              // Double-check event listeners are attached
              nextBtns.forEach(btn => {
                if (!btn.onclick && !btn._hasClickListener) {
                  btn.onclick = () => {
                    // Trigger click on original functionality
                    const track = carousel.querySelector('.carousel-track, .carousel-track-compact');
                    if (track) {
                      // Simple fallback navigation
                      const slides = carousel.querySelectorAll('.carousel-slide, .carousel-slide-compact');
                      let currentTransform = track.style.transform || 'translateX(0%)';
                      let currentX = parseInt(currentTransform.match(/-?\d+/) || [0])[0];
                      let nextX = currentX - 100;
                      if (Math.abs(nextX) >= slides.length * 100) {
                        nextX = 0; // Loop back
                      }
                      track.style.transform = `translateX(${nextX}%)`;
                    }
                  };
                  btn._hasClickListener = true;
                }
              });
              
              prevBtns.forEach(btn => {
                if (!btn.onclick && !btn._hasClickListener) {
                  btn.onclick = () => {
                    const track = carousel.querySelector('.carousel-track, .carousel-track-compact');
                    if (track) {
                      const slides = carousel.querySelectorAll('.carousel-slide, .carousel-slide-compact');
                      let currentTransform = track.style.transform || 'translateX(0%)';
                      let currentX = parseInt(currentTransform.match(/-?\d+/) || [0])[0];
                      let prevX = currentX + 100;
                      if (prevX > 0) {
                        prevX = -(slides.length - 1) * 100; // Loop to end
                      }
                      track.style.transform = `translateX(${prevX}%)`;
                    }
                  };
                  btn._hasClickListener = true;
                }
              });
            });
          }, 100);
        }, 300);
        
        // ESC key support
        escListener = function(e) {
          if (e.key === 'Escape') closeModal();
        };
        document.addEventListener('keydown', escListener);
      }
      function closeModal() {
        const overlay = document.querySelector('.modal-overlay');
        if (overlay) overlay.remove();
        document.body.classList.remove('modal-open');
        if (escListener) {
          document.removeEventListener('keydown', escListener);
          escListener = null;
        }
      }
      // Attach maximize button logic
      document.querySelectorAll('.collapsible').forEach(function(coll) {
        const maxBtn = coll.querySelector('.maximize-btn');
        const content = coll.nextElementSibling;
        if (maxBtn && content) {
          maxBtn.onclick = function(e) {
            e.stopPropagation();
            createModal(content);
          };
        }
      });
    });
</script>

<style>
  .table { font-size: 15px; line-height: 25px; display: grid; grid-template-columns: max-content 1fr; grid-gap: 5px 10px; }
  .table > div:nth-child(2n+1) { font-weight: 300; } 
  figure { width: 650px; margin: 120px -26px -85px; }
  figure > a { border: none; display: block; }
  h1 { margin-bottom: -80px; }
  h2 { margin-top: 120px !important; }
  .gh-stars:before { content:"★"; font-size: 20px; vertical-align: baseline; position: relative; top: -1px; margin: 0 5px 0 10px; }
  .gh-stars { color: #00000090; }
  .icon { width: 128px; height: 128px; position: absolute; margin: 120px 0 0 -148px; }
  blockquote { position: relative; margin-bottom: 3em; }
  .quote-author { position: absolute; right: 0; }
  .svglogo { color: #000000; }

  .kategori{ display: grid;}

  .collapsible {
    position: relative;
    display: flex;
    align-items: center;
    min-height: 44px;
    padding: 0 18px;
    font-size: 15px;
    margin-top: 10px;
    transition: all 0.3s ease;
    border-radius: 4px 4px 0 0;
    background-color: #777;
    color: white;
    cursor: pointer;
    width: 100%;
    border: none;
    text-align: left;
    outline: none;
  }
  .collapsible-title {
    display: flex;
    align-items: center;
    flex: 1 1 auto;
    font-size: 1em;
    font-weight: 400;
    line-height: 40px;
    white-space: pre-line;
  }
  
  .project-date {
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.85em;
    font-weight: 300;
    margin-left: 12px;
    margin-right: 8px;
    opacity: 0.8;
  }
  .maximize-btn {
    background: var(--btn-bg);
    color: var(--primary-text);
    border: 1px solid var(--border-color);
    border-radius: 50%;
    width: 32px;
    height: 32px;
    font-size: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    margin-left: auto;
    margin-right: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    transition: background 0.2s, color 0.2s, box-shadow 0.2s;
    flex-shrink: 0;
  }

  .active, .collapsible:hover {
    background-color: #555;
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }

  .content {
    max-height: 0;
    overflow: hidden;
    opacity: 0;
    padding: 0 15px;
    border-top: none;
    border-radius: 0 0 4px 4px;
    transition: all 0.4s ease-in-out;
    transform: translateY(-10px);
  }

  .content-open {
    max-height: 1200px;
    opacity: 1;
    padding: 15px;
    transform: translateY(0);
  }

  iframe {
    width: 100%;
    border: none;
    overflow: hidden;
    transition: opacity 0.3s ease-in-out;
  }

  #map-cyprus {
    height: 400px;
  }

  .project-link {
    color: var(--primary-text);
    background: transparent;
    text-decoration: none;
    font-size: 0.85em;
    font-weight: 400;
    margin: 5px 8px 5px 0;
    display: inline-block;
    padding: 6px 12px;
    border: 1px solid var(--accent-color);
    border-radius: 3px;
    transition: all 0.2s ease;
  }

  .project-link:hover {
    color: var(--accent-color);
    background: transparent;
    border-color: var(--accent-color);
  }

  .project-description {
    margin: 15px 0 10px 0;
    animation: fadeInUp 0.5s ease-out 0.2s both;
  }

  .project-description p {
    margin-bottom: 12px;
  }

  .project-buttons {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 0;
    margin-top: 8px;
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Enhanced hover effects for better interaction */
  .collapsible:not(.active):hover {
    background-color: #666;
  }

  .active {
    background-color: #555;
    border-radius: 4px 4px 0 0;
  }

  /* Smooth iframe loading animation */
  .sketchfab-embed-wrapper {
    animation: fadeInUp 0.6s ease-out 0.3s both;
  }
  .collapsible {
    position: relative;
  }
  .collapsible.active .maximize-btn {
    display: flex !important;
    opacity: 1;
    pointer-events: auto;
  }
  .maximize-btn:hover {
    background: var(--btn-hover);
    color: var(--primary-bg);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  }
  /* Modal overlay for maximized view */
  :root {
    --modal-overlay-bg: rgba(0,0,0,0.7);
  }
  html[data-theme="dark"] {
    --modal-overlay-bg: rgba(0,0,0,0.85);
  }
  .modal-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: var(--modal-overlay-bg);
    z-index: 9998;
    display: flex;
    align-items: center;
    justify-content: center;
    animation: fadeIn 0.3s;
  }
  
  .modal-overlay .modal-maximized {
    position: relative;
  }
  .modal-maximized {
    position: relative;
    width: 95vw;
    max-width: 1200px;
    max-height: 90vh;
    min-height: 300px;
    background: var(--primary-bg);
    color: var(--primary-text);
    z-index: 9999;
    box-shadow: 0 8px 40px rgba(0,0,0,0.25);
    border-radius: 10px;
    overflow-y: auto;
    opacity: 1;
    padding: 40px 40px 30px 40px;
    border: 1px solid var(--border-color);
    transition: all 0.3s cubic-bezier(.4,2,.6,1);
    animation: fadeInUp 0.4s;
    display: flex;
    flex-direction: column;
  }
  .modal-close-btn {
    position: absolute;
    top: -10px;
    right: -10px;
    z-index: 99999;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--btn-bg);
    color: var(--primary-text);
    border: 1px solid var(--border-color);
    border-radius: 50%;
    font-size: 22px;
    cursor: pointer;
    box-shadow: 0 2px 8px rgba(0,0,0,0.10);
    transition: background 0.2s, color 0.2s, box-shadow 0.2s;
    outline: none;
  }
  .modal-close-btn:hover {
    background: var(--btn-hover);
    color: var(--primary-bg);
    box-shadow: 0 4px 16px rgba(0,0,0,0.18);
  }
  .modal-overlay { /* ensure close btn is always above modal content */
    padding-top: 32px;
    padding-right: 40px;
    box-sizing: border-box;
  }
  .minimize-btn { display: none !important; } /* Hide old minimize button */
  body.modal-open {
    overflow: hidden !important;
  }
  
  /* Make iframe much larger in modal view */
  .modal-maximized iframe {
    height: 70vh !important;
    min-height: 500px;
    max-height: 80vh;
    width: 100%;
  }
  
  .modal-maximized .sketchfab-embed-wrapper {
    display: flex;
    flex-direction: column;
    margin-bottom: 25px;
    flex-grow: 1;
  }
  
  .modal-maximized .project-description {
    flex-shrink: 0;
    max-height: 25vh;
    overflow-y: auto;
  }
  
  /* Ensure modal utilizes available space efficiently */
  .modal-maximized {
    min-height: 70vh !important;
  }
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
</style>

<ul class="menu">
  <li><a class="menu__item" href="/">{{ t.nav.blog }}</a></li>
  <li><span class="menu__item menu__item_selected" href="/projects/">{{ t.nav.projects }}</span></li>
  <li><a class="menu__item" href="/resume/">{{ t.nav.resume }}</a></li>
  <div class="spacer"></div>
</ul>

<div class="post">
{% if site.projects.size > 0 %}
  {% comment %} Filter and deduplicate projects {% endcomment %}
  {% assign all_projects = site.projects | where_exp: "project", "project.hidden != true" | sort: "date" | reverse %}
  {% assign unique_projects = "" | split: "" %}
  {% assign processed_groups = "" | split: "" %}
  
  {% for project in all_projects %}
    {% assign should_include = true %}
    
    {% comment %} Determine project language {% endcomment %}
    {% assign project_lang = project.lang | default: 'tr' %}
    
    {% if project.translations %}
      {% comment %} Create a consistent group identifier by sorting translation URLs {% endcomment %}
      {% assign translation_urls = "" | split: "" %}
      {% for translation in project.translations %}
        {% assign translation_urls = translation_urls | push: translation.url %}
      {% endfor %}
      {% assign translation_urls = translation_urls | sort %}
      {% assign group_id = translation_urls | join: "|" %}
      
      {% comment %} Check if we already processed this translation group {% endcomment %}
      {% assign group_already_processed = false %}
      {% for processed_group in processed_groups %}
        {% if processed_group == group_id %}
          {% assign group_already_processed = true %}
          {% break %}
        {% endif %}
      {% endfor %}
      
      {% if group_already_processed %}
        {% comment %} Group already processed, skip this iteration {% endcomment %}
        {% assign should_include = false %}
      {% else %}
        {% comment %} First time seeing this group, find the best version for Turkish page {% endcomment %}
        {% assign processed_groups = processed_groups | push: group_id %}
        
        {% comment %} Look for Turkish version in this translation group {% endcomment %}
        {% assign turkish_project = null %}
        {% assign fallback_project = project %}
        
        {% comment %} Check current project {% endcomment %}
        {% if project_lang == 'tr' %}
          {% assign turkish_project = project %}
        {% endif %}
        
        {% comment %} Check other translations if we haven't found Turkish version yet {% endcomment %}
        {% unless turkish_project %}
          {% for translation in project.translations %}
            {% if translation.lang == 'tr' %}
              {% comment %} Find the actual Turkish project object {% endcomment %}
              {% for other_project in all_projects %}
                {% if other_project.url == translation.url %}
                  {% assign turkish_project = other_project %}
                  {% break %}
                {% endif %}
              {% endfor %}
              {% break %}
            {% endif %}
          {% endfor %}
        {% endunless %}
        
        {% comment %} Use Turkish version if found, otherwise use current project {% endcomment %}
        {% if turkish_project %}
          {% assign unique_projects = unique_projects | push: turkish_project %}
        {% else %}
          {% assign unique_projects = unique_projects | push: fallback_project %}
        {% endif %}
        
        {% assign should_include = false %}
      {% endif %}
    {% else %}
      {% comment %} No translations, include the project {% endcomment %}
      {% assign unique_projects = unique_projects | push: project %}
      {% assign should_include = false %}
    {% endif %}
  {% endfor %}
  
  {% assign categories = unique_projects | group_by: "category" %}
  {% for category in categories %}
  <div class="kategori">
    <div class="baslik">
      <h4>{{ category.name }}</h4>
    </div>
    {% for project in category.items %}
    {% comment %} Determine language indicators {% endcomment %}
    {% assign lang_indicators = "" %}
    {% assign project_lang = project.lang | default: 'tr' %}
    
    {% comment %} Check if translations exist {% endcomment %}
    {% if project.translations %}
      {% assign has_en = false %}
      {% assign has_tr = false %}
      {% if project_lang == 'en' %}
        {% assign has_en = true %}
      {% else %}
        {% assign has_tr = true %}
      {% endif %}
      
      {% for translation in project.translations %}
        {% if translation.lang == 'en' %}
          {% assign has_en = true %}
        {% elsif translation.lang == 'tr' %}
          {% assign has_tr = true %}
        {% endif %}
      {% endfor %}
      
      {% if has_tr and has_en %}
        {% assign lang_indicators = "[TR/EN]" %}
      {% elsif has_en %}
        {% assign lang_indicators = "[EN]" %}
      {% else %}
        {% assign lang_indicators = "[TR]" %}
      {% endif %}
    {% else %}
      {% comment %} No translations, check if we have English fields {% endcomment %}
      {% assign has_en_fields = false %}
      {% if project.title_en or project.description_en %}
        {% assign has_en_fields = true %}
      {% endif %}
      
      {% if project_lang == 'en' or has_en_fields %}
        {% if has_en_fields %}
          {% assign lang_indicators = "[TR/EN]" %}
        {% else %}
          {% assign lang_indicators = "[EN]" %}
        {% endif %}
      {% else %}
        {% assign lang_indicators = "[TR]" %}
      {% endif %}
    {% endif %}
    
    {% comment %} Determine display title and description {% endcomment %}
    {% assign display_title = project.title %}
    {% assign display_description = project.description %}
    {% assign iframe_title = project.title %}
    
    <button type="button" class="collapsible">
      <span class="collapsible-title">{{ display_title }}{% if project.has_full_page %} <span class="language-indicator">{{ lang_indicators }}</span>{% endif %}</span>
      <span class="project-date">{{ project.date | date: "%Y" }}</span>
      <span class="maximize-btn" style="display:none;">⛶</span>
    </button>
    <div class="content">
      {% if project.show_carousel and project.carousel_images %}
        {% comment %} Split the project URL to get the folder name {% endcomment %}
        {% assign url_parts = project.url | split: '/' %}
        {% assign project_folder = url_parts | last %}
        {% include image-carousel-compact.html folder=project_folder images=project.carousel_images %}
      {% elsif project.embed_url %}
      <div class="sketchfab-embed-wrapper">
        <iframe title="{{ iframe_title }}" frameborder="0" allowfullscreen mozallowfullscreen="true" webkitallowfullscreen="true" allow="autoplay; fullscreen; xr-spatial-tracking" xr-spatial-tracking execution-while-out-of-viewport execution-while-not-rendered web-share width="100%" height="300" src="{{ project.embed_url }}"></iframe>
      </div>
      {% endif %}
      <div class="project-description">
        {% if display_description %}
        <p>{{ display_description }}</p>
        {% endif %}
        <div class="project-buttons">
          {% if project.has_full_page %}
          {% if current_lang == 'tr' %}
          <a href="{{ project.url }}" class="project-link">Detaylı Bilgi</a>
          {% else %}
          <a href="{{ project.url }}" class="project-link">More Details</a>
          {% endif %}
          {% endif %}
          {% if project.site_url %}
          <a href="{{ project.site_url }}" class="project-link" target="_blank" rel="noopener noreferrer">{{ t.project.visit_site }}</a>
          {% endif %}
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% endfor %}
{% else %}
  {% if current_lang == 'tr' %}
  <p>henüz proje eklenmemiş</p>
  {% else %}
  <p>no projects added yet</p>
  {% endif %}
{% endif %}
</div>