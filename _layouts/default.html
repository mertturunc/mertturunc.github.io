{% include language-utils.html %}
<!doctype html>
<html lang="{{ current_lang }}" prefix="og: http://ogp.me/ns#" xmlns:og="http://opengraphprotocol.org/schema/">
<head>
  <meta http-equiv="content-type" content="text/html;charset=UTF-8"/>
  {% if page.class == "page_wide" %}
    <meta name="viewport" content="width=900" />
  {% else %}
    <meta name="viewport" content="width=640" />
  {% endif %}
  <meta name="theme-color" content="hsl(199, 39%, 39%)">
  <link href="/i/favicon.png" rel="icon" sizes="32x32">

  <!-- Apply theme immediately to prevent flash -->
  <script>
    (function() {
      const savedTheme = localStorage.getItem('theme') || 'dark';
      if (savedTheme === 'dark') {
        document.documentElement.setAttribute('data-theme', 'dark');
      }
    })();
  </script>

  <link href='/style.css?v=20201203' rel='stylesheet' type='text/css' />
  <title>{{ page.title }} @ {{ t.site_title }}</title>

  <link href="/blog/atom.xml" rel="alternate" title="atr0p's blog" type="application/atom+xml" />

  <meta name="author" content="Mert Turun√ß" />
  
  <!-- Open Graph meta tags for LinkedIn and other social media -->
  <meta property="og:type" content="{% if page.categories contains 'blog' %}article{% else %}website{% endif %}" />
  <meta property="og:title" content="{{ page.title }}" />
  <meta property="og:description" content="{% if page.summary %}{{ page.summary }}{% elsif page.description %}{{ page.description }}{% else %}{{ t.site_description }}{% endif %}" />
  <meta property="og:url" content="{{ site.url }}{{ page.url }}" />
  <meta property="og:site_name" content="{{ t.site_title }}" />
  {% if page.header %}
    {% if page.header contains '://' %}
      <meta property="og:image" content="{{ page.header }}" />
    {% else %}
      <meta property="og:image" content="{{ site.url }}{{ page.header }}" />
    {% endif %}
  {% else %}
    <meta property="og:image" content="{{ site.url }}/i/favicon_normal.jpg" />
  {% endif %}
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta property="og:image:type" content="image/jpeg" />
  
  {% if page.categories contains 'blog' %}
    <meta property="article:published_time" content="{{ page.date | date: '%Y-%m-%d' }}" />
    <meta property="article:author" content="Mert Turun√ß" />
  {% endif %}

  <!-- Twitter Card meta tags -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="@GeoTurunc" />
  <meta name="twitter:creator" content="@GeoTurunc" />
  <meta name="twitter:title" content="{{ page.title }}" />
  <meta name="twitter:description" content="{% if page.summary %}{{ page.summary }}{% elsif page.description %}{{ page.description }}{% else %}{{ t.site_description }}{% endif %}" />
  {% if page.header %}
    {% if page.header contains '://' %}
      <meta name="twitter:image" content="{{ page.header }}" />
    {% else %}
      <meta name="twitter:image" content="{{ site.url }}{{ page.header }}" />
    {% endif %}
  {% else %}
    <meta name="twitter:image" content="{{ site.url }}/i/favicon_normal.jpg" />
  {% endif %}

  {% comment %} Add alternate language links {% endcomment %}
  {% if current_lang == 'tr' %}
    <link rel="alternate" hreflang="en" href="https://mertturunc.github.io/en{{ page.url }}" />
    <link rel="alternate" hreflang="tr" href="https://mertturunc.github.io{{ page.url }}" />
  {% else %}
    <link rel="alternate" hreflang="tr" href="https://mertturunc.github.io{{ page.url | remove: '/en' }}" />
    <link rel="alternate" hreflang="en" href="https://mertturunc.github.io{{ page.url }}" />
  {% endif %}
</head>
<body>
<!-- Top controls -->
<div class="top-controls">
  <!-- Theme Toggle Button -->
  <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
    <span id="theme-icon">‚òÄÔ∏è</span>
  </button>
  
  <!-- Language Switcher -->
  {% include language-switcher.html %}
</div>

<div class="page {{ page.class }}">

{{ content }}

<div class="preload"></div>

<script>
// Theme switching functionality
(function() {
  const themeToggle = document.getElementById('theme-toggle');
  const themeIcon = document.getElementById('theme-icon');
  const html = document.documentElement;
  
  // Get current theme state
  const currentTheme = localStorage.getItem('theme') || 'dark';
  
  // Update icon based on current theme
  function updateIcon(theme) {
    if (theme === 'dark') {
      themeIcon.textContent = '‚òÄÔ∏è';
    } else {
      themeIcon.textContent = 'üåô';
    }
  }
  
  // Initialize icon
  updateIcon(currentTheme);
  
  // Theme toggle click handler
  themeToggle.addEventListener('click', function() {
    const isCurrentlyDark = html.hasAttribute('data-theme');
    const newTheme = isCurrentlyDark ? 'light' : 'dark';
    
    // Apply new theme
    if (newTheme === 'dark') {
      html.setAttribute('data-theme', 'dark');
    } else {
      html.removeAttribute('data-theme');
    }
    
    // Update icon
    updateIcon(newTheme);
    
    // Save preference
    localStorage.setItem('theme', newTheme);
  });
})();

// Header anchor links functionality
(function() {
  // Function to create a URL-friendly slug from text
  function createSlug(text) {
    return text
      .toLowerCase()
      .replace(/[^\w\s-]/g, '') // Remove special characters
      .replace(/\s+/g, '-')     // Replace spaces with hyphens
      .replace(/-+/g, '-')      // Replace multiple hyphens with single
      .trim();
  }

  // Add anchor links to headers
  document.addEventListener('DOMContentLoaded', function() {
    const headers = document.querySelectorAll('h1:not(.r-title), h2, h3, h4, h5, h6');
    
    headers.forEach(function(header) {
      // Create slug from header text
      const slug = createSlug(header.textContent);
      
      // Set the id if it doesn't exist
      if (!header.id) {
        header.id = slug;
      }
      
      // Add click handler
      header.addEventListener('click', function() {
        // Update URL with anchor
        const newUrl = window.location.pathname + window.location.search + '#' + header.id;
        window.history.pushState(null, null, newUrl);
        
        // Optional: scroll to header smoothly
        header.scrollIntoView({ behavior: 'smooth' });
        
        // Copy link to clipboard
        navigator.clipboard.writeText(window.location.href).then(function() {
          // Show a brief visual feedback
          const originalColor = header.style.color;
          header.style.color = 'var(--accent-color)';
          setTimeout(function() {
            header.style.color = originalColor;
          }, 200);
        }).catch(function() {
          // Fallback if clipboard API is not available
          console.log('Link: ' + window.location.href);
        });
      });
    });
  });
})();

// Copy button functionality for code blocks
(function() {
  // Get translation strings (will be populated by Jekyll)
  const translations = {
    copy: '{{ t.copy_button.copy }}',
    copied: '{{ t.copy_button.copied }}',
    error: '{{ t.copy_button.error }}'
  };

  function createCopyButton() {
    const button = document.createElement('button');
    button.className = 'copy-button';
    button.innerHTML = 'üìã ' + translations.copy;
    button.setAttribute('aria-label', 'Copy code to clipboard');
    return button;
  }

  function copyToClipboard(text, button) {
    if (navigator.clipboard && window.isSecureContext) {
      // Use modern clipboard API
      navigator.clipboard.writeText(text).then(function() {
        showCopySuccess(button);
      }).catch(function() {
        fallbackCopyToClipboard(text, button);
      });
    } else {
      // Fallback for older browsers or non-secure contexts
      fallbackCopyToClipboard(text, button);
    }
  }

  function fallbackCopyToClipboard(text, button) {
    const textArea = document.createElement('textarea');
    textArea.value = text;
    textArea.style.position = 'fixed';
    textArea.style.left = '-999999px';
    textArea.style.top = '-999999px';
    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();
    
    try {
      document.execCommand('copy');
      showCopySuccess(button);
    } catch (err) {
      console.error('Failed to copy text: ', err);
      showCopyError(button);
    } finally {
      document.body.removeChild(textArea);
    }
  }

  function showCopySuccess(button) {
    const originalText = button.innerHTML;
    button.innerHTML = '‚úÖ ' + translations.copied;
    button.classList.add('copied');
    
    setTimeout(function() {
      button.innerHTML = originalText;
      button.classList.remove('copied');
    }, 2000);
  }

  function showCopyError(button) {
    const originalText = button.innerHTML;
    button.innerHTML = '‚ùå ' + translations.error;
    
    setTimeout(function() {
      button.innerHTML = originalText;
    }, 2000);
  }

  function addCopyButtonToCodeBlock(codeBlock) {
    // Skip if button already exists (more robust check)
    if (codeBlock.querySelector('.copy-button') || codeBlock.hasAttribute('data-copy-button-added')) {
      return;
    }
    
    // Mark this element as processed to prevent duplicate processing
    codeBlock.setAttribute('data-copy-button-added', 'true');

    const button = createCopyButton();
    
    button.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      
      // Get the code content - look for code element in various structures
      let codeElement = codeBlock.querySelector('code');
      if (!codeElement) {
        // If no code element, use the pre element or the container itself
        codeElement = codeBlock.querySelector('pre') || codeBlock;
      }
      
      let codeText = codeElement.textContent || codeElement.innerText;
      
      // Clean up the text (remove extra whitespace)
      codeText = codeText.trim();
      
      copyToClipboard(codeText, button);
    });

    // Find the best container for the button (the one with the visual styling)
    let buttonContainer = codeBlock;
    
    // For Rouge blocks, append to the inner .highlight div for proper positioning
    const highlightDiv = codeBlock.querySelector('.highlight');
    if (highlightDiv) {
      buttonContainer = highlightDiv;
    }
    
    buttonContainer.appendChild(button);
  }

  // Initialize copy buttons when DOM is ready
  function initializeCopyButtons() {
    // Strategy: Only target the outermost container for each code block
    // This prevents duplicate buttons on nested elements
    
    // For Jekyll/Rouge: target .highlighter-rouge containers (the outermost wrapper)
    const rougeBlocks = document.querySelectorAll('.highlighter-rouge');
    
    // For standalone pre elements (not inside any syntax highlighting wrapper)
    const standalonePreBlocks = document.querySelectorAll('pre:not(.highlighter-rouge pre):not(.highlight)');
    
    // Add copy buttons to Rouge syntax-highlighted blocks
    rougeBlocks.forEach(function(codeBlock) {
      addCopyButtonToCodeBlock(codeBlock);
    });
    
    // Add copy buttons to standalone pre blocks
    standalonePreBlocks.forEach(function(codeBlock) {
      addCopyButtonToCodeBlock(codeBlock);
    });
  }

  // Run on DOM content loaded
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeCopyButtons);
  } else {
    initializeCopyButtons();
  }

  // Also run after a short delay to catch any dynamically added content
  setTimeout(initializeCopyButtons, 100);
})();
</script>

</body>
</html>


